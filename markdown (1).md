## 目标



<section class="content"><article class="markdown-section" id="main"> <div id="dark_mode">
             <input class="container_toggle" type="checkbox" id="switch" name="mode">
             <label for="switch">Toggle</label>
           </div><h1 id="安装mqtt服务器"><a href="#/n06.mqtt?id=%e5%ae%89%e8%a3%85mqtt%e6%9c%8d%e5%8a%a1%e5%99%a8" data-id="安装mqtt服务器" class="anchor"><span>安装<code>MQTT</code>服务器</span></a></h1><h2 id="_1-什么是mqtt"><a href="#/n06.mqtt?id=_1-%e4%bb%80%e4%b9%88%e6%98%afmqtt" data-id="_1-什么是mqtt" class="anchor"><span>1. 什么是<code>MQTT</code></span></a></h2><p><code>MQTT</code>是一种网络通信协议。</p><p>详细知识我们已经讲解过，如果不太清楚，可以浏览如下链接</p><p><a href="https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/c05.mqtt" target="_blank" rel="noopener">https://doc.itprojects.cn/0006.zhishi.esp32/02.doc/index.html#/c05.mqtt</a></p><h2 id="_2-安装mqtt服务器"><a href="#/n06.mqtt?id=_2-%e5%ae%89%e8%a3%85mqtt%e6%9c%8d%e5%8a%a1%e5%99%a8" data-id="_2-安装mqtt服务器" class="anchor"><span>2. 安装<code>MQTT</code>服务器</span></a></h2><h3 id="_21-下载镜像"><a href="#/n06.mqtt?id=_21-%e4%b8%8b%e8%bd%bd%e9%95%9c%e5%83%8f" data-id="_21-下载镜像" class="anchor"><span>2.1 下载镜像</span></a></h3><p>我们采用的是<code>EMQX</code>这一款<code>MQTT</code>服务软件，官网地址如下</p><p><a href="https://www.emqx.io/zh" target="_blank" rel="noopener">https://www.emqx.io/zh</a></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184379052.png" data-origin="assets/1676184379052.png" alt="1676184379052"></p><p>下面开始安装</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184404069.png" data-origin="assets/1676184404069.png" alt="1676184404069"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184466255.png" data-origin="assets/1676184466255.png" alt="1676184466255"></p><p>下载<code>EMQX</code>镜像的命令</p><pre v-pre="" data-lang=""><code class="lang-">sudo docker pull emqx/emqx:5.0.16</code><button class="docsify-copy-code-button"><span class="label">复制</span><span class="error">Error</span><span class="success">复制成功...</span></button></pre><p>创建<code>EMQX</code>虚拟机（容器）的命令</p><pre v-pre="" data-lang=""><code class="lang-">sudo docker run -d --name emqx -p 1883:1883 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083 emqx/emqx:5.0.16</code><button class="docsify-copy-code-button"><span class="label">复制</span><span class="error">Error</span><span class="success">复制成功...</span></button></pre><p>打开宝塔的终端，然后输入命令开始下载镜像，如下图</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184601678.png" data-origin="assets/1676184601678.png" alt="1676184601678"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184692436.png" data-origin="assets/1676184692436.png" alt="1676184692436"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184757976.png" data-origin="assets/1676184757976.png" alt="1676184757976"></p><h3 id="_22-创建虚拟机（容器）"><a href="#/n06.mqtt?id=_22-%e5%88%9b%e5%bb%ba%e8%99%9a%e6%8b%9f%e6%9c%ba%ef%bc%88%e5%ae%b9%e5%99%a8%ef%bc%89" data-id="_22-创建虚拟机（容器）" class="anchor"><span>2.2 创建虚拟机（容器）</span></a></h3><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676184952026.png" data-origin="assets/1676184952026.png" alt="1676184952026"></p><p>查看是否运行成功，输入如下命令</p><pre v-pre="" data-lang=""><code class="lang-">sudo docker ps</code><button class="docsify-copy-code-button"><span class="label">复制</span><span class="error">Error</span><span class="success">复制成功...</span></button></pre><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185055482.png" data-origin="assets/1676185055482.png" alt="1676185055482"></p><p>只要能看到<code>emqx</code>则表示<code>mqtt</code>服务器已经运行起来了</p><h2 id="_3-配置防火墙"><a href="#/n06.mqtt?id=_3-%e9%85%8d%e7%bd%ae%e9%98%b2%e7%81%ab%e5%a2%99" data-id="_3-配置防火墙" class="anchor"><span>3. 配置防火墙</span></a></h2><p>配置允许<code>1883</code>、<code>18083</code>端口</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185194701.png" data-origin="assets/1676185194701.png" alt="1676185194701"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185778968.png" data-origin="assets/1676185778968.png" alt="1676185778968"></p><p>配置完成如下图</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185831246.png" data-origin="assets/1676185831246.png" alt="1676185831246"></p><p>登录查看<code>MQTT</code>服务器运行状态，注意默认密码<code>public</code></p><p><a href="http://101.43.125.129:18083/" target="_blank" rel="noopener">http://101.43.125.129:18083/</a></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185926951.png" data-origin="assets/1676185926951.png" alt="1676185926951"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185970187.png" data-origin="assets/1676185970187.png" alt="1676185970187"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186030438.png" data-origin="assets/1676186030438.png" alt="1676186030438"></p><p>修改后，会重新用新密码登录</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186071613.png" data-origin="assets/1676186071613.png" alt="1676186071613"></p><p>登录成功之后的样子如下</p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186096154.png" data-origin="assets/1676186096154.png" alt="1676186096154"></p><h2 id="_4-homeassistant安装mqtt客户端"><a href="#/n06.mqtt?id=_4-homeassistant%e5%ae%89%e8%a3%85mqtt%e5%ae%a2%e6%88%b7%e7%ab%af" data-id="_4-homeassistant安装mqtt客户端" class="anchor"><span>4. <code>HomeAssistant</code>安装<code>MQTT</code>客户端</span></a></h2><h3 id="_41-安装"><a href="#/n06.mqtt?id=_41-%e5%ae%89%e8%a3%85" data-id="_41-安装" class="anchor"><span>4.1 安装</span></a></h3><p>登录自己的HomeAssistant系统，例如当前王老师的URL如下</p><pre v-pre="" data-lang=""><code class="lang-">http://101.43.125.129:8123/</code><button class="docsify-copy-code-button"><span class="label">复制</span><span class="error">Error</span><span class="success">复制成功...</span></button></pre><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185418895.png" data-origin="assets/1676185418895.png" alt="1676185418895"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185557577.png" data-origin="assets/1676185557577.png" alt="1676185557577"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676185584660.png" data-origin="assets/1676185584660.png" alt="1676185584660"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186310123.png" data-origin="assets/1676186310123.png" alt="1676186310123"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186365348.png" data-origin="assets/1676186365348.png" alt="1676186365348"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186403347.png" data-origin="assets/1676186403347.png" alt="1676186403347"></p><h3 id="_42-测试"><a href="#/n06.mqtt?id=_42-%e6%b5%8b%e8%af%95" data-id="_42-测试" class="anchor"><span>4.2 测试</span></a></h3><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186472860.png" data-origin="assets/1676186472860.png" alt="1676186472860"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186522541.png" data-origin="assets/1676186522541.png" alt="1676186522541"></p><p><img src="https://doc.itprojects.cn/0017.iot/assets/1676186634484.png" data-origin="assets/1676186634484.png" alt="1676186634484"></p><hr><footer><span>Copyright © doc.itprojects.cn，合作以及项目交流, 请联系微信dong4716138</span></footer></article></section>
### 原理

